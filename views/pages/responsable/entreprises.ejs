<!-- ============================ Page Title Start ================================== -->
<section class="call-to-act" style="background:#0b85ec url(/img/landing-bg.png) no-repeat">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-12 col-md-12">
        <h2 class="text-light">Liste des Entreprises</h2>
        <span class="ipn-subtitle text-light">
          Dashboard Responsable — <span style="color:#0c0101; font-weight:600;">Gestion des entreprises</span>
        </span>
      </div>
    </div>
  </div>
</section>
<!-- ============================ Page Title End ================================== -->

<!-- ============================ Entreprises Section ================================== -->
<section class="gray-bg" style="padding: 60px 0;">
  <div class="container">
    <div class="row justify-content-center">

      <% if (entreprises.length === 0) { %>
        <div class="col-lg-8 text-center">
          <p>Aucune entreprise enregistrée pour le moment.</p>
        </div>
      <% } else { %>

        <% entreprises.forEach(e => { %>
          <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12 mb-4">
            <div class="card shadow-sm position-relative" style="border-radius: 15px; overflow: hidden;">

              <!-- Dropdown Actions -->
              <div class="dropdown position-absolute top-0 end-0 m-2">
                <button class="btn btn-sm btn-light dropdown-toggle" type="button" id="dropdownMenu<%= e._id %>"
                  data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="fa fa-cog"></i>
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu<%= e._id %>">
                  <li><a class="dropdown-item" href="/entreprises/<%= e._id %>"><i class="fa fa-info-circle me-2"></i> Voir les détails</a></li>
                  <li><a class="dropdown-item" href="/entreprises/edit/<%= e._id %>"><i class="fa fa-edit me-2"></i> Modifier</a></li>
                  <li><a class="dropdown-item text-danger" href="#" onclick="supprimerEntreprise('<%= e._id %>')"><i class="fa fa-trash me-2"></i> Supprimer</a></li>
                </ul>
              </div>

              <div class="card-body text-center">
                <img src="<%= e.logo ? e.logo : '/img/co-4.jpg' %>" class="img-fluid rounded-circle mb-3"
                  style="width: 100px; height: 100px; object-fit: cover;" alt="Logo entreprise">

                <h5 class="card-title mb-1"><%= e.name %></h5>
                <p class="text-muted mb-2"><i class="fa fa-envelope"></i> <%= e.email %></p>
                <p class="mb-2"><i class="fa fa-phone"></i> <%= e.phone %></p>
                <p><i class="fa fa-map-marker-alt"></i> <%= e.address %></p>

                <!-- Badge Statut dynamique -->
                <%
                const createdDate = new Date(e.createdAt);
                const now = new Date();
                const diffMs = now - createdDate;
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                let badgeText = '';
                let badgeClass = 'bg-success';

                if (diffDays < 1) {
                    badgeText = 'Créée aujourd’hui';
                    badgeClass = 'bg-info';
                } else if (diffDays < 7) {
                    badgeText = `Active depuis ${diffDays} jour${diffDays > 1 ? 's' : ''}`;
                    badgeClass = 'bg-success';
                } else if (diffDays < 30) {
                    const weeks = Math.floor(diffDays / 7);
                    badgeText = `Active depuis ${weeks} semaine${weeks > 1 ? 's' : ''}`;
                    badgeClass = 'bg-primary';
                } else if (diffDays < 365) {
                    const months = Math.floor(diffDays / 30);
                    badgeText = `Active depuis ${months} mois`;
                    badgeClass = 'bg-warning text-dark';
                } else {
                    const years = Math.floor(diffDays / 365);
                    badgeText = `Active depuis ${years} an${years > 1 ? 's' : ''}`;
                    badgeClass = 'bg-secondary';
                }
                %>

                <span class="badge <%= badgeClass %>" style="font-size: 0.9em;">
                <%= badgeText %>
                </span>

              </div>

              <div class="card-footer text-center" style="background-color: #f8f9fa;">
                <a href="/entreprises/<%= e._id %>/formations" class="btn btn-sm btn-outline-primary">
                  <i class="fa fa-chalkboard-teacher"></i> Voir les formations
                </a>
              </div>
            </div>
          </div>
        <% }) %>

      <% } %>
    </div>
  </div>
</section>
<!-- ============================ Entreprises Section End ================================== -->
