<!-- ============================ Page Title Start ================================== -->
<section class="call-to-act" style="background:#ec780bd5 url(/img/landing-bg.png) no-repeat">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-12 col-md-12">
        <h2 class="text-light">Liste des Formations</h2>
        <span class="ipn-subtitle text-light">
          Dashboard Entreprise -
          <span style="color: #0c0101; font-weight: 600;">Formations en attente ou refus√©es</span>
        </span>
      </div>
    </div>
  </div>
</section>
<!-- ============================ Page Title End ================================== -->


<!-- ============================ Main Section Start ================================== -->
<section class="gray-bg py-5">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">

        <% if (formations.length===0) { %>
          <div class="alert alert-info mt-4 text-center">
            Aucune formation en attente ou refus√©e.
          </div>
          <% } else { %>

            <!-- Barre recherche / filtre -->
            <div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
              <div class="input-group w-auto">
                <input type="text" id="searchInput" class="form-control" placeholder="Rechercher une formation...">
                <button class="btn btn-dark" type="button"><i class="fa fa-search"></i></button>
              </div>

              <div class="dropdown">
                <button class="btn btn-outline-primary dropdown-toggle" type="button" id="filterDropdown"
                  data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="fa fa-filter me-2"></i> Filtrer par statut
                </button>
                <ul class="dropdown-menu" aria-labelledby="filterDropdown">
                  <li><a class="dropdown-item filter-option active" data-status="tous">Toutes</a></li>
                  <li><a class="dropdown-item filter-option" data-status="En attente">En attente</a></li>
                  <li><a class="dropdown-item filter-option" data-status="Refus√©e">Refus√©e</a></li>
                </ul>
              </div>
            </div>

            <!-- Messages flash -->
            <% if (success && success.length > 0) { %>
              <div class="alert alert-success alert-dismissible fade show text-center mt-3" role="alert">
                <strong><i class="fa fa-check-circle"></i> <%= success %></strong>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fermer"></button>
              </div>
            <% } %>

            <!-- Tableau -->
            <table class="table table-striped table-bordered mt-4">
              <thead class="table-primary text-center">
                <tr>
                  <th>Image</th>
                  <th>Titre</th>
                  <th>Entreprise</th>
                  <th>Dur√©e</th>
                  <th>Prix</th>
                  <th>Statut</th>
                  <th>Actions</th>
                </tr>
              </thead>

              <tbody id="formationsTable">
                <% formations.forEach(formation=> { %>
                  <tr class="align-middle text-center" data-status="<%= formation.status %>">

                    <!-- Image -->
                    <td>
                      <img src="<%= formation.image || '/img/co-4.jpg' %>" class="img-fluid rounded" width="80"
                        height="60" alt="Formation Image">
                    </td>

                    <td>
                      <strong>
                        <%= formation.title %>
                      </strong>
                    </td>
                    <td>
                      <%= formation.entreprise?.name || 'N/A' %>
                    </td>
                    <td>
                      <%= formation.duration %> heures
                    </td>
                    <td>
                      <%= formation.price %> DT
                    </td>

                    <td>
                      <% if (formation.status==='En attente' ) { %>
                        <span class="badge bg-warning text-dark px-3 py-2">En attente</span>
                        <% } else if (formation.status==='Refus√©e' ) { %>
                          <span class="badge bg-danger px-3 py-2">Refus√©e</span>
                          <% } %>
                    </td>

                    <!-- Actions dynamiques (Entreprise) -->
                    <!-- Actions dynamiques -->
                    <td>
                      <form action="/responsable/formations/<%= formation._id %>/validate" method="POST"
                        style="display:inline;"
                        onsubmit="return confirm('Voulez-vous vraiment valider cette formation ?');">
                        <button class="btn btn-success btn-sm" title="Valider">
                          <i class="fa fa-check"></i>
                        </button>
                      </form>
                      <% if (formation.status==='En attente' ) { %>
                        <!-- Peut √™tre refus√©e -->
                        <form action="/responsable/formations/<%= formation._id %>/reject" method="POST"
                          style="display:inline;"
                          onsubmit="return confirm('Voulez-vous vraiment refuser cette formation ?');">
                          <button class="btn btn-warning btn-sm text-dark" title="Refuser">
                            <i class="fa fa-times"></i>
                          </button>
                        </form>

                        <% } else if (formation.status==='Refus√©e' ) { %>
                          <!-- Peut √™tre supprim√©e -->
                          <form action="/responsable/formations/<%= formation._id %>/delete" method="POST"
                            style="display:inline;"
                            onsubmit="return confirm('Voulez-vous vraiment supprimer cette formation ?');">
                            <button class="btn btn-danger btn-sm" title="Supprimer">
                              <i class="fa fa-trash"></i>
                            </button>
                          </form>

                          <% } %>

                            <!-- D√©tails (toujours visible) -->
                            <a href="/formations/all/<%= formation._id %>" class="btn btn-info btn-sm"
                              title="Voir d√©tails">
                              <i class="fa fa-eye"></i>
                            </a>
                    </td>
                  </tr>
                  <% }) %>
              </tbody>
            </table>
            <% } %>

      </div>
    </div>
  </div>
</section>
<!-- ============================ Main Section End ================================== -->


<!-- ============================ Styles ============================ -->
<style>
  .gray-bg {
    background-color: #f8f9fa;
  }

  .table th,
  .table td {
    vertical-align: middle;
  }

  .table thead {
    background-color: #ec780bd5 !important;
    color: white;
  }

  .btn-sm i {
    margin-right: 2px;
  }

  .badge {
    font-size: 0.9em;
    border-radius: 8px;
  }

  .filter-option.active {
    background-color: #0b85ec;
    color: white !important;
  }

  .alert strong {
    font-weight: 600;
  }
  .alert-success {
    border: 2px solid #198754;
    box-shadow: 0 0 10px rgba(25, 135, 84, 0.3);
  }
  .alert-danger {
    border: 2px solid #dc3545;
    box-shadow: 0 0 10px rgba(220, 53, 69, 0.3);
  }
</style>


<!-- ============================ JS Recherche & Filtrage ============================ -->
<script>
  // üîç Recherche dynamique
  document.getElementById('searchInput').addEventListener('input', function () {
    const search = this.value.toLowerCase();
    document.querySelectorAll('#formationsTable tr').forEach(row => {
      const title = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
      row.style.display = title.includes(search) ? '' : 'none';
    });
  });

   // üïí Disparition automatique du message apr√®s 4 secondes
  setTimeout(() => {
    const alert = document.querySelector('.alert');
    if (alert) {
      alert.classList.remove('show');
      alert.classList.add('fade');
      setTimeout(() => alert.remove(), 500);
    }
  }, 4000);

  // üéØ Filtrage par statut
  document.querySelectorAll('.filter-option').forEach(opt => {
    opt.addEventListener('click', function () {
      document.querySelectorAll('.filter-option').forEach(o => o.classList.remove('active'));
      this.classList.add('active');

      const status = this.getAttribute('data-status');
      document.querySelectorAll('#formationsTable tr').forEach(row => {
        const rowStatus = row.getAttribute('data-status');
        row.style.display = (status === 'tous' || rowStatus === status) ? '' : 'none';
      });
    });
  });
</script>