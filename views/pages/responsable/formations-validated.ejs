<!-- ============================ Page Title Start ================================== -->
<section class="call-to-act" style="background:#198754 url(/img/landing-bg.png) no-repeat">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-12 col-md-12">
        <h2 class="text-light">Formations Validées</h2>
        <span class="ipn-subtitle text-light">
          Dashboard Responsable -
          <span style="color: #0c0101; font-weight: 600;">Liste des formations validées</span>
        </span>
      </div>
    </div>
  </div>
</section>
<!-- ============================ Page Title End ================================== -->


<!-- ============================ Main Section Start ================================== -->
<section class="gray-bg py-5">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">

        <% if (formations.length === 0) { %>
          <div class="alert alert-info mt-4 text-center">
            Aucune formation validée pour le moment.
          </div>
        <% } else { %>

          <!-- Barre recherche / tri -->
          <div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
            <!-- Recherche -->
            <div class="input-group w-auto">
              <input type="text" id="searchInput" class="form-control" placeholder="Rechercher une formation...">
              <button class="btn btn-dark" type="button"><i class="fa fa-search"></i></button>
            </div>

            <!-- Tri par -->
            <div class="dropdown">
              <button class="btn btn-outline-primary dropdown-toggle" type="button" id="sortDropdown"
                data-bs-toggle="dropdown" aria-expanded="false">
                Trier par
              </button>
              <ul class="dropdown-menu" aria-labelledby="sortDropdown">
                <li><a class="dropdown-item sort-option active" data-sort="none">Aucun</a></li>
                <li><a class="dropdown-item sort-option" data-sort="price">Prix</a></li>
                <li><a class="dropdown-item sort-option" data-sort="duration">Durée</a></li>
              </ul>
            </div>
          </div>

          <!-- Message flash -->
          <% if (success && success.length > 0) { %>
            <div class="alert alert-success alert-dismissible fade show text-center mt-3" role="alert">
              <strong><i class="fa fa-check-circle"></i> <%= success %></strong>
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fermer"></button>
            </div>
          <% } %>

          <!-- Tableau -->
          <table class="table table-striped table-bordered mt-4">
            <thead class="table-primary text-center">
              <tr>
                <th>Image</th>
                <th>Titre</th>
                <th>Entreprise</th>
                <th>Durée</th>
                <th>Prix</th>
                <th>Statut</th>
                <th>Actions</th>
              </tr>
            </thead>

            <tbody id="formationsTable">
              <% formations.forEach(formation => { %>
                <tr class="align-middle text-center">
                  <td>
                    <img src="<%= formation.image || '/img/co-4.jpg' %>" class="img-fluid rounded" width="80"
                      height="60" alt="Formation Image">
                  </td>
                  <td><strong><%= formation.title %></strong></td>
                  <td><%= formation.entreprise?.name || 'N/A' %></td>
                  <td data-duration="<%= formation.duration %>"><%= formation.duration %> jours</td>
                  <td data-price="<%= formation.price %>"><%= formation.price %> DT</td>
                  <td><span class="badge bg-success px-3 py-2">Validée</span></td>
                  <td>
                    <form action="/responsable/formations/<%= formation._id %>/reject" method="POST"
                      style="display:inline;"
                      onsubmit="return confirm('Voulez-vous vraiment refuser cette formation ?');">
                      <button class="btn btn-warning btn-sm" title="Refuser">
                        <i class="fa fa-times"></i>
                      </button>
                    </form>
                    <form action="/responsable/formations/<%= formation._id %>/delete" method="POST"
                      style="display:inline;"
                      onsubmit="return confirm('Voulez-vous vraiment supprimer cette formation ?');">
                      <button class="btn btn-danger btn-sm" title="Supprimer">
                        <i class="fa fa-trash"></i>
                      </button>
                    </form>
                    <a href="/formations/all/<%= formation._id %>" class="btn btn-info btn-sm" title="Voir détails">
                      <i class="fa fa-eye"></i>
                    </a>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } %>
      </div>
    </div>
  </div>
</section>
<!-- ============================ Main Section End ================================== -->


<!-- ============================ Styles ============================ -->
<style>
  .gray-bg {
    background-color: #f8f9fa;
  }

  .table th,
  .table td {
    vertical-align: middle;
  }

  .table thead {
    background-color: #198754 !important;
    color: white;
  }

  .alert strong {
    font-weight: 600;
  }

  .alert-success {
    border: 2px solid #198754;
    box-shadow: 0 0 10px rgba(25, 135, 84, 0.3);
  }

  .filter-option.active {
    background-color: #198754;
    color: white !important;
  }
</style>


<!-- ============================ JS Recherche & Tri ============================ -->
<script>
  // Recherche dynamique
  document.getElementById('searchInput').addEventListener('input', function () {
    const search = this.value.toLowerCase();
    document.querySelectorAll('#formationsTable tr').forEach(row => {
      const title = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
      row.style.display = title.includes(search) ? '' : 'none';
    });
  });

  // Tri par prix ou durée
  document.querySelectorAll('.sort-option').forEach(opt => {
    opt.addEventListener('click', function () {
      document.querySelectorAll('.sort-option').forEach(o => o.classList.remove('active'));
      this.classList.add('active');

      const sortType = this.getAttribute('data-sort');
      const table = document.getElementById('formationsTable');
      const rows = Array.from(table.querySelectorAll('tr'));

      if (sortType === 'none') {
        rows.sort((a, b) => 0); // Aucun tri
      } else if (sortType === 'price') {
        rows.sort((a, b) => {
          return parseFloat(a.querySelector('[data-price]').dataset.price) -
                 parseFloat(b.querySelector('[data-price]').dataset.price);
        });
      } else if (sortType === 'duration') {
        rows.sort((a, b) => {
          return parseFloat(a.querySelector('[data-duration]').dataset.duration) -
                 parseFloat(b.querySelector('[data-duration]').dataset.duration);
        });
      }

      // Réinjection des lignes triées
      rows.forEach(r => table.appendChild(r));
    });
  });
</script>
